<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Order Form</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header>
  <h1>Order Form</h1>
  <p>Please fill in your payment details below</p>
</header>
<main>
  <section class="order-summary">
    <h2>Order Summary</h2>
    <div class="summary-row">
      <span>Item</span>
      <span>$333 / month</span>
    </div>
    <div class="summary-row total">
      <span>Total</span>
      <span>$100</span>
    </div>
  </section>
  <form class="checkout-form" action="#" method="post" novalidate>
  <section class="payment-method">
    <h2>Payment Method</h2>
    <div class="methods" role="radiogroup" aria-label="Payment method">
      <div class="method-type is-active" data-method="card" role="radio" aria-checked="true" tabindex="0">
        <img src="assets/cards.webp" alt="Credit Card" />
        <div class="method-title">Credit Card</div>
      </div>
      <div class="method-type" data-method="paypal" role="radio" aria-checked="false" tabindex="0">
        <img src="assets/paypal.webp" alt="PayPal" />
        <div class="method-title">PayPal</div>
      </div>
    </div>
  </section>
  <section class="paypal-info" aria-hidden="true">
    <h2>PayPal Email</h2>
    <div class="paypal-grid">
      <div class="field paypal-email">
        <label for="paypal-email">Email</label>
        <input type="email" id="paypal-email" name="paypal-email" placeholder="email@example.com" autocomplete="email" inputmode="email" />
      </div>
    </div>
  </section>
  <section class="card-info">
    <h2>Card Information</h2>
    <div class="card-grid">
      <div class="field card-number">
        <label for="card-number">Card Number</label>
        <input type="text" id="card-number" name="card-number" placeholder="1234 5678 9012 3456" autocomplete="cc-number" inputmode="numeric" maxlength="19" />
      </div>
      <div class="field exp-date">
        <label for="exp-date">Expiry Date</label>
        <input type="text" id="exp-date" name="exp-date" placeholder="MM / YY" autocomplete="cc-exp" inputmode="numeric" maxlength="7" />
      </div>
      <div class="field sec-code">
        <label for="sec-code">CVV</label>
        <input type="text" id="sec-code" name="sec-code" placeholder="123" autocomplete="cc-csc" inputmode="numeric" maxlength="4" />
      </div>
    </div>
  </section>
  <div class="submit-button">
    <button id="buy-now" type="submit">Buy Now</button>
  </div>
  </form>
  <div class="need-help">
    <p>Need help?</p>
  </div>
</main>

<script>
  (function formValidation() {
    const q = sel => document.querySelector(sel);
    const qa = sel => Array.from(document.querySelectorAll(sel));

    // ---- live input filters & formatting ----

    // Only digits helper
    function digitsOnly(str) {
      return str.replace(/\D+/g, '');
    }

    // Card number: keep digits, format as "#### #### #### ####", max 16 digits
    const cardNumberInput = q('#card-number');
    if (cardNumberInput) {
      cardNumberInput.addEventListener('input', () => {
        const digits = digitsOnly(cardNumberInput.value).slice(0, 16);
        // group into 4s
        const grouped = digits.replace(/(\d{4})(?=\d)/g, '$1 ');
        cardNumberInput.value = grouped;
        // clear error as user types
        cardNumberInput.closest('.field')?.classList.remove('error');
        cardNumberInput.closest('.field')?.removeAttribute('data-error');
      });
    }

    // Expiry: auto add " / " after MM, clamp MM to 01-12, allow "MM / YY"
    const expInput = q('#exp-date');
    if (expInput) {
      expInput.addEventListener('input', () => {
        let digits = digitsOnly(expInput.value).slice(0, 4); // MMYY

        // Ensure first digit sane; if user types 9 -> make it 09
        if (digits.length === 1) {
          const d = parseInt(digits, 10);
          if (d > 1) digits = '0' + digits;
        }

        let mm = digits.slice(0, 2);
        let yy = digits.slice(2);

        if (mm.length === 2) {
          let mVal = parseInt(mm, 10);
          if (mVal < 1) mVal = 1;
          if (mVal > 12) mVal = 12;
          mm = String(mVal).padStart(2, '0');
        }

        expInput.value = yy.length ? `${mm} / ${yy}` : (mm ? `${mm} / ` : '');
        expInput.closest('.field')?.classList.remove('error');
        expInput.closest('.field')?.removeAttribute('data-error');
      });
    }

    // CVV: only digits, up to 4
    const cvvInput = q('#sec-code');
    if (cvvInput) {
      cvvInput.addEventListener('input', () => {
        cvvInput.value = digitsOnly(cvvInput.value).slice(0, 4);
        cvvInput.closest('.field')?.classList.remove('error');
        cvvInput.closest('.field')?.removeAttribute('data-error');
      });
    }

    // Email: clear error as user types
    const paypalEmail = q('#paypal-email');
    if (paypalEmail) {
      paypalEmail.addEventListener('input', () => {
        paypalEmail.closest('.field')?.classList.remove('error');
        paypalEmail.closest('.field')?.removeAttribute('data-error');
      });
    }

    function clearErrors(fields) {
      fields.forEach(f => {
        f.classList.remove('error');
        f.removeAttribute('data-error');
      });
    }

    function markErrors(inputs, message) {
      inputs.forEach(input => {
        const wrapper = input.closest('.field') || input;
        wrapper.classList.add('error');
        // Always set a message; default to "Required" if none provided
        wrapper.setAttribute('data-error', message || 'Required');
      });
    }

    function requiredEmpty(inputs) {
      return inputs.filter(input => !input.value.trim());
    }

    function validateCard() {
      const numberEl = q('#card-number');
      const expEl = q('#exp-date');
      const cvvEl = q('#sec-code');

      clearErrors(qa('.card-grid .field'));

      // Required check
      const empties = requiredEmpty([numberEl, expEl, cvvEl]);
      if (empties.length) {
        markErrors(empties);
        return false;
      }

      // Card number: exactly 16 digits (spaces ignored)
      const digits = (numberEl.value || '').replace(/\s+/g, '');
      if (!/^\d{16}$/.test(digits)) {
        markErrors([numberEl], 'Invalid card number');
        return false;
      }

      // Expiry: "MM / YY", month 01–12
      const m = (expEl.value || '').match(/^(\d{2})\s*\/\s*(\d{2})$/);
      if (!m) {
        markErrors([expEl], 'Use MM / YY');
        return false;
      }
      const mm = parseInt(m[1], 10);
      if (mm < 1 || mm > 12) {
        markErrors([expEl], 'Month 01–12');
        return false;
      }

      // CVV: 3 or 4 digits
      if (!/^\d{3,4}$/.test(cvvEl.value || '')) {
        markErrors([cvvEl], '3–4 digits');
        return false;
      }

      return true;
    }

    function validatePaypal() {
      const email = q('#paypal-email');
      clearErrors(qa('.paypal-grid .field'));
      if (!email || !email.value.trim()) {
        markErrors([email]);
        return false;
      }
      // simple email regex
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!re.test(email.value.trim())) {
        markErrors([email], 'Wrong email format');
        return false;
      }
      return true;
    }

    // Payment method toggle
    const methods = qa('.method-type');
    const cardInfo = q('.card-info');
    const paypalInfo = q('.paypal-info');

    methods.forEach(m => {
      m.addEventListener('click', () => {
        methods.forEach(x => {
          x.classList.remove('is-active');
          x.setAttribute('aria-checked', 'false');
        });
        m.classList.add('is-active');
        m.setAttribute('aria-checked', 'true');

        if (m.dataset.method === 'card') {
          cardInfo.style.display = '';
          paypalInfo.style.display = 'none';
          paypalInfo.setAttribute('aria-hidden', 'true');
        } else {
          cardInfo.style.display = 'none';
          paypalInfo.style.display = '';
          paypalInfo.setAttribute('aria-hidden', 'false');
        }
      });

      // Keyboard support: Space/Enter toggles selection; arrows move focus
      m.addEventListener('keydown', (e) => {
        if (e.key === ' ' || e.key === 'Enter') {
          e.preventDefault();
          m.click();
        }
        if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
          e.preventDefault();
          const idx = methods.indexOf(m);
          const next = methods[(idx + 1) % methods.length];
          next.focus();
        }
        if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
          e.preventDefault();
          const idx = methods.indexOf(m);
          const prev = methods[(idx - 1 + methods.length) % methods.length];
          prev.focus();
        }
      });
    });

    // Submit handler
    const buyNow = q('#buy-now');
    const needHelp = document.querySelector('.need-help p');
    if (needHelp) {
      needHelp.addEventListener('click', () => {
        alert('The page is not yet ready.');
      });
    }

    // Press feedback on Buy Now
    buyNow.addEventListener('mousedown', () => {
      buyNow.style.transform = 'scale(0.97)';
      buyNow.style.filter = 'brightness(0.95)';
    });
    buyNow.addEventListener('mouseup', () => {
      buyNow.style.transform = 'scale(1)';
      buyNow.style.filter = 'none';
    });
    buyNow.addEventListener('click', (e) => {
      e.preventDefault();

      const activeMethod = q('.method-type.is-active');
      if (!activeMethod) return;

      if (activeMethod.dataset.method === 'card') {
        if (!validateCard()) return;
      } else {
        if (!validatePaypal()) return;
      }

      alert('Oops! Something went wrong.');
    });

  })();
</script>
</body>
</html>